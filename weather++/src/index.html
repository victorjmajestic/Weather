<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset ="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="theme-color" content="#EE6565">
        <title>Weather++</title>
        <link rel="manifest" href="manifest.json">
        <link rel="apple-touch-icon" href="/images/placeholder-icon.png">
        <link rel="stylesheet" href="https://cdn.rawgit.com/mochajs/mocha/2.2.5/mocha.css"/>
    </head>

    <body>
        <h1>Weather++</h1>
        <p>sample text</p>
        <script src="/src/index.js"></script>

        <button onclick="getWeatherInfo()">Use My Location</button>

        <p id="User Locale"></p>
        <p id ="Forecast Data"></p>

        <script>
            const x = document.getElementById("User Locale");
            const y = document.getElementById("Forecast Data")


            function getLocation() {
                let location;
                try {
                    navigator.geolocation.getCurrentPosition(showPosition);
                } catch {
                    x.innerHTML = err;
                }
                    function showPosition(position) {
                    x.innerHTML = "Latitude: " + position.coords.latitude + 
                    "<br>Longitude: " + position.coords.longitude;
                    location = position.coords.latitude + "," + position.coords.longitude;
                    return location;
                }  
            } 
            async function getWeatherInfo() {
                location = getLocation();
                try {
                    let metaRes = await fetch("https://api.weather.gov/points/" + location, {
                        "method": "GET",
                        "headers": {}
                    });
                    return await JSON.parse(metaRes.json());
                }
                catch (error) {
                    console.log(error);
                }
            }
            async function getForecast() {
                let forecastURL = await getWeatherInfo().properties.forecast;
                try {
                    let forecastRes = await fetch("forecastURL", {
                        "method": "GET",
                        "headers": {}
                    });
                    let forecast = await JSON.parse(forecastRes.json());
                }
                catch (error) {
                    console.log(error);
                }
                y.innerHTML = forecast.properties.periods[1];
            }
            /*    fetch("https://api.weather.gov/points/" + position.coords.latitude + "," + position.coords.longitude, {
                    "method": "GET",
                    "headers": {
                        //accept: application/geo+json
                    }
                })
                .then((response) => response.json())
                .then((data) => console.log(data))
                .then(())
                //.then(response => {
                //    console.log(data);
                //})
                .catch(err => {
                    console.error(err);
                });
                let forecasturl = data.properties.forecast;
                fetch(forecasturl, {
                    "method": "GET",
                    "headers": {}
                })
                .then((response) => response.json())
                .then((data) => console.log(data))
            }*/

            
        </script>

        <!--service worker script-->
        <script src="/src/index.js"></script>

        <!--unit test script -->
        <div id="mocha"></div>
        <script src="https://cdn.rawgit.com/Automattic/expect.js/0.3.1/index.js"></script>
        <script src="https://cdn.rawgit.com/chaijs/chai/3.5.0/chai.js"></script>
        <script src="https://cdn.rawgit.com/mochajs/mocha/2.2.5/mocha.js"></script>
        <script>
            const mocha = window.mocha;
            mocha.setup('bdd');
          </script>
          <script src="unittests.js"></script>
          <script>
            mocha.checkLeaks();
            mocha.run();
          </script>

    </body>

</html>